<style>
    .args {
        border-radius: 0.5em;
        border: 1px solid black;
        border-width: 0px 1px;
        padding: 0em 0.5em;
    }
    
    .dead-result {
        background: rgba(255, 0, 0, 0.15);
        border: 1px solid red;
        margin: -1px;
    }
    
    .children-selected table {
        background-color: red;
    }
    
    .horiz-component:not(:last-child) > table > tr:last-child::after  {
        content: ",";
        vertical-align: middle;
        display: table-cell;
    }
    
    #cursor {
        display: inline-block;
        height: 0.7em;
        padding: 0.3em 0.1em 0.3em 0.1em;
        margin: -0.3em -0.1em -0.3em -0.1em;
        background: rgba(0,0,0,0.5);
    }
    
    table {
        padding: 1px;
        border-spacing: 0px;
    }
    
    </style>
    
    <div>
    <b>How to use:</b> navigate with the mouse or arrow keys (up and down move between arguments). "Enter" enters edit mode. "Esc" exits edit mode. 
    Type to rename things. Vertical elements in parens are function arguments. ^T toggles "horizontal" mode for a cell. Note that if 
    you are immediatly inside of a horizontal cell, it unfolds to vertical. Comma makes a new element immeditately after the current one, as
    does "Enter" if you're already in edit mode. Edits output continuously, be careful of putting the code in an infinite loop, which will 
    currently hang the GUI. </div>
    
    <div>The default example above computes the summation from for <code>i = low</code> to <code>i = high</code> of <code>func(i)</code>.</div>
    
    <div id="container">
    </div>
    
    Output: <div id="code"></div>
    
    <script src="minimal-loader.js">
    </script>
    <script src="main.js?1">
    </script>
    <script>
        const editor = new modules.editor.EditorView();
        editor.program = {"name":"letrec","args":[{"name":"inc","args":[{"name":"lambda","args":[{"name":"","args":[{"name":"x"}]},{"name":"+","args":[{"name":"x"},{"name":"1"}]}]}]},{"name":"∑","args":[{"name":"lambda","args":[{"name":"","args":[{"name":"low"},{"name":"high"},{"name":"func"},{"name":"accum"}]},{"name":"if","args":[{"name":">","args":[{"name":"low"},{"name":"high"}]},{"name":"accum"},{"name":"∑", "args":[{"name":"inc","args":[{"name":"low"}]},{"name":"high"},{"name":"func"},{"name":"+","args":[{"name":"accum"},{"name":"func","args":[{"name":"low"}]}]}]}]}]}]},{"name":"∑","args":[{"name":"1"},{"name":"3"},{"name":"lambda","args":[{"name":"","args":[{"name":"x"}]},{"name":"*","args":[{"name":"x"},{"name":"x"}]}]},{"name":"0"}]}]};
        editor.draw();

        window.addEventListener("keypress", (e)=>editor.onkeypress(e));
        window.addEventListener("keydown", (e)=>editor.onkeydown(e));
        
        document.getElementById("container").appendChild(editor.container);

        editor.onedit = ()=>{
            const testWorker = new Worker('worker-starter.js?1');
            testWorker.addEventListener("message", function(msg) {
                const flat = modules.language.flattenIdxToPair(editor.root);
                let [idx, value] = msg.data;
                const pair = flat.get(idx);
                console.log("worker:", pair, value);
                if (value.message) {
                    value = "DeadResult: " + value.message;
                }
                const view = editor.map.get(pair);
                view.head.title = value;

                if (idx === 0) {
                    document.getElementById("code").innerHTML = value;
                }
            });
            testWorker.postMessage(editor.root);
        };
    </script>